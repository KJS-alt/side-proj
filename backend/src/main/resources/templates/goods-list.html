<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OnBid ë¬¼ê±´ ì¡°íšŒ ê²°ê³¼</title>
    <style>
        /* ì „ì—­ ìŠ¤íƒ€ì¼ */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
        }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        nav {
            background: #34495e;
            padding: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        nav ul {
            list-style: none;
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        nav li { 
            margin: 0; 
        }
        
        nav a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            transition: background 0.3s;
        }
        
        nav a:hover { 
            background: #2c3e50; 
        }
        
        nav a.active { 
            background: #3498db; 
        }
        
        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        /* í˜ì´ì§€ í—¤ë” */
        .page-header {
            background: white;
            padding: 25px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-header h1 {
            color: #2c3e50;
            margin: 0;
        }
        
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover { 
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover { 
            background: #7f8c8d; 
        }
        
        /* ë©”ì‹œì§€ */
        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid #17a2b8;
        }
        
        /* ê²€ìƒ‰ ì¡°ê±´ ìš”ì•½ */
        .search-summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .search-summary h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .summary-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .summary-item {
            background: #ecf0f1;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #2c3e50;
        }
        
        .summary-item strong {
            color: #3498db;
        }
        
        /* XML ê²°ê³¼ */
        .result-box {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 3px;
            overflow-x: auto;
            max-height: 500px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* ê²°ê³¼ í…Œì´ë¸” */
        .result-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination {
            text-align: center;
            margin-top: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .pagination a {
            display: inline-block;
            padding: 10px 18px;
            background: white;
            color: #3498db;
            text-decoration: none;
            border: 2px solid #3498db;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .pagination a:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .pagination .current {
            background: #3498db;
            color: white;
            padding: 10px 18px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .summary-items {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav>
        <ul>
            <li><a href="/goods/">í™ˆ</a></li>
            <li><a href="/goods/search">ë¬¼ê±´ ì¡°íšŒ</a></li>
            <li><a href="/goods/search?sido=ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸ ë¬¼ê±´</a></li>
            <li><a href="/goods/search?sido=ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚° ë¬¼ê±´</a></li>
        </ul>
    </nav>
    
    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="page-header">
            <h1>ê²€ìƒ‰ ê²°ê³¼</h1>
            <a href="/goods/search" class="btn btn-primary">ë‹¤ì‹œ ê²€ìƒ‰</a>
        </div>
        
        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div th:if="${!success}" class="alert alert-error">
            âœ— API í˜¸ì¶œ ì‹¤íŒ¨: <span th:text="${error}"></span>
        </div>
        
        <!-- ê²€ìƒ‰ ì¡°ê±´ ìš”ì•½ -->
        <div th:if="${success}" class="search-summary">
            <h3>ğŸ” ê²€ìƒ‰ ì¡°ê±´</h3>
            <div class="summary-items">
                <div class="summary-item">
                    <strong>í˜ì´ì§€:</strong> <span th:text="${pageNo}"></span>
                </div>
                <div class="summary-item">
                    <strong>ì¡°íšŒ ê°œìˆ˜:</strong> <span th:text="${numOfRows}"></span>ê°œ
                </div>
                <div th:if="${ctgrHirkId}" class="summary-item">
                    <strong>ì¹´í…Œê³ ë¦¬:</strong> 
                    <span th:text="${ctgrHirkId == '10000' ? 'í† ì§€' : ctgrHirkId == '20000' ? 'ê±´ë¬¼' : ctgrHirkId == '30000' ? 'ì°¨ëŸ‰' : ctgrHirkId == '40000' ? 'íšŒì›ê¶Œ' : ctgrHirkId == '50000' ? 'ê¸°ê³„/ê¸°êµ¬' : ctgrHirkId == '60000' ? 'íŠ¹ìˆ˜ìì‚°' : ctgrHirkId}"></span>
                </div>
                <div th:if="${sido}" class="summary-item">
                    <strong>ì‹œ/ë„:</strong> <span th:text="${sido}"></span>
                </div>
                <div th:if="${sgk}" class="summary-item">
                    <strong>ì‹œ/êµ°/êµ¬:</strong> <span th:text="${sgk}"></span>
                </div>
                <div th:if="${emd}" class="summary-item">
                    <strong>ì/ë©´/ë™:</strong> <span th:text="${emd}"></span>
                </div>
                <div th:if="${cltrNm}" class="summary-item">
                    <strong>ë¬¼ê±´ëª…:</strong> <span th:text="${cltrNm}"></span>
                </div>
                <div th:if="${goodsPriceFrom}" class="summary-item">
                    <strong>ê°ì •ê°€(ìµœì†Œ):</strong> <span th:text="${goodsPriceFrom}"></span>ì›
                </div>
                <div th:if="${goodsPriceTo}" class="summary-item">
                    <strong>ê°ì •ê°€(ìµœëŒ€):</strong> <span th:text="${goodsPriceTo}"></span>ì›
                </div>
                <div th:if="${openPriceFrom}" class="summary-item">
                    <strong>ìµœì €ì…ì°°ê°€(ìµœì†Œ):</strong> <span th:text="${openPriceFrom}"></span>ì›
                </div>
                <div th:if="${openPriceTo}" class="summary-item">
                    <strong>ìµœì €ì…ì°°ê°€(ìµœëŒ€):</strong> <span th:text="${openPriceTo}"></span>ì›
                </div>
                <div th:if="${pbctBegnDtm}" class="summary-item">
                    <strong>ì…ì°°ì¼ì(From):</strong> <span th:text="${pbctBegnDtm}"></span>
                </div>
                <div th:if="${pbctClsDtm}" class="summary-item">
                    <strong>ì…ì°°ì¼ì(To):</strong> <span th:text="${pbctClsDtm}"></span>
                </div>
            </div>
        </div>
        
        <!-- ê²€ìƒ‰ ê²°ê³¼ í…Œì´ë¸” -->
        <div th:if="${xmlResponse}" class="result-table">
            <div id="results"></div>
            <div class="result-box" id="xmlData" style="display:none;" th:text="${xmlResponse}"></div>
            
            <script>
                // XML íŒŒì‹± ë° í…Œì´ë¸” ìƒì„±
                const xmlText = document.getElementById('xmlData').textContent;
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                // totalCount ì¶”ì¶œ
                const totalCount = xmlDoc.querySelector('totalCount')?.textContent || '0';
                
                // items ì¶”ì¶œ
                const items = xmlDoc.querySelectorAll('item');
                
                let html = `
                    <div class="alert alert-info" style="margin: 20px;">
                        <strong>ì´ ${totalCount}ê±´</strong> ê²€ìƒ‰ë¨ (í˜„ì¬ í˜ì´ì§€: ${items.length}ê±´)
                    </div>
                `;
                
                if (items.length > 0) {
                    html += `
                        <table style="width:100%; border-collapse:collapse; background:white;">
                            <thead style="background:#3498db; color:white;">
                                <tr>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ë²ˆí˜¸</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ì¹´í…Œê³ ë¦¬</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ë¬¼ê±´ëª…</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ì†Œì¬ì§€</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ê°ì •ê°€</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ìµœì €ì…ì°°ê°€</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ì…ì°°ê¸°ê°„</th>
                                    <th style="padding:14px; border:1px solid #ddd; text-align:center;">ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    items.forEach((item, index) => {
                        const rnum = item.querySelector('RNUM')?.textContent || '-';
                        const category = item.querySelector('CTGR_FULL_NM')?.textContent || '-';
                        const name = item.querySelector('CLTR_NM')?.textContent || '-';
                        const addr = item.querySelector('NMRD_ADRS')?.textContent || 
                                    item.querySelector('LDNM_ADRS')?.textContent || '-';
                        const appraisal = parseInt(item.querySelector('APSL_ASES_AVG_AMT')?.textContent || '0');
                        const minBid = parseInt(item.querySelector('MIN_BID_PRC')?.textContent || '0');
                        const bidStart = item.querySelector('PBCT_BEGN_DTM')?.textContent || '';
                        const bidEnd = item.querySelector('PBCT_CLS_DTM')?.textContent || '';
                        const status = item.querySelector('PBCT_CLTR_STAT_NM')?.textContent || '-';
                        
                        // ë‚ ì§œ í¬ë§·íŒ… (YYYYMMDDHHMISS -> YYYY-MM-DD HH:MM)
                        const formatDate = (str) => {
                            if (str.length >= 12) {
                                return `${str.substr(0,4)}-${str.substr(4,2)}-${str.substr(6,2)} ${str.substr(8,2)}:${str.substr(10,2)}`;
                            }
                            return str;
                        };
                        
                        // ê¸ˆì•¡ í¬ë§·íŒ…
                        const formatPrice = (price) => {
                            return price.toLocaleString('ko-KR') + 'ì›';
                        };
                        
                        // ìƒíƒœë³„ ìƒ‰ìƒ ì„¤ì •
                        let statusColor = '#e8f5e9';
                        let statusTextColor = '#2e7d32';
                        if (status.includes('ì…ì°°ëŒ€ê¸°') || status.includes('ì…ì°°ì¤€ë¹„ì¤‘')) {
                            statusColor = '#fff3e0';
                            statusTextColor = '#e65100';
                        } else if (status.includes('ì…ì°°ì§„í–‰ì¤‘')) {
                            statusColor = '#e3f2fd';
                            statusTextColor = '#1565c0';
                        } else if (status.includes('ìœ ì°°') || status.includes('ë‚™ì°°')) {
                            statusColor = '#fce4ec';
                            statusTextColor = '#c2185b';
                        }
                        
                        html += `
                            <tr style="border-bottom:1px solid #ddd; transition: background 0.2s;">
                                <td style="padding:12px; border:1px solid #ddd; text-align:center; font-weight:bold;">${rnum}</td>
                                <td style="padding:12px; border:1px solid #ddd;">${category}</td>
                                <td style="padding:12px; border:1px solid #ddd; max-width:300px; overflow:hidden; text-overflow:ellipsis;" title="${name}">${name}</td>
                                <td style="padding:12px; border:1px solid #ddd; max-width:200px; overflow:hidden; text-overflow:ellipsis; font-size:0.9em;" title="${addr}">${addr}</td>
                                <td style="padding:12px; border:1px solid #ddd; text-align:right; font-weight:bold;">${formatPrice(appraisal)}</td>
                                <td style="padding:12px; border:1px solid #ddd; text-align:right; font-weight:bold; color:#e74c3c;">${formatPrice(minBid)}</td>
                                <td style="padding:12px; border:1px solid #ddd; font-size:0.85em; text-align:center;">
                                    ${formatDate(bidStart)}<br><span style="color:#7f8c8d;">~</span><br>${formatDate(bidEnd)}
                                </td>
                                <td style="padding:12px; border:1px solid #ddd; text-align:center;">
                                    <span style="display:inline-block; padding:6px 12px; background:${statusColor}; color:${statusTextColor}; border-radius:15px; font-size:0.85em; font-weight:bold;">${status}</span>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                        <style>
                            table tbody tr:hover {
                                background: #f8f9fa !important;
                            }
                        </style>
                    `;
                } else {
                    html += '<div class="alert alert-info" style="margin: 20px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</div>';
                }
                
                document.getElementById('results').innerHTML = html;
            </script>
        </div>
        
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div th:if="${success}" class="pagination">
            <a th:if="${pageNo > 1}"
               th:href="@{/goods/list(pageNo=${pageNo - 1}, numOfRows=${numOfRows}, ctgrHirkId=${ctgrHirkId}, sido=${sido}, sgk=${sgk}, emd=${emd}, cltrNm=${cltrNm}, goodsPriceFrom=${goodsPriceFrom}, goodsPriceTo=${goodsPriceTo}, openPriceFrom=${openPriceFrom}, openPriceTo=${openPriceTo}, pbctBegnDtm=${pbctBegnDtm}, pbctClsDtm=${pbctClsDtm}, cltrMnmtNo=${cltrMnmtNo})}">
                â† ì´ì „ í˜ì´ì§€
            </a>
            <span class="current" th:text="${pageNo}">1</span>
            <a th:href="@{/goods/list(pageNo=${pageNo + 1}, numOfRows=${numOfRows}, ctgrHirkId=${ctgrHirkId}, sido=${sido}, sgk=${sgk}, emd=${emd}, cltrNm=${cltrNm}, goodsPriceFrom=${goodsPriceFrom}, goodsPriceTo=${goodsPriceTo}, openPriceFrom=${openPriceFrom}, openPriceTo=${openPriceTo}, pbctBegnDtm=${pbctBegnDtm}, pbctClsDtm=${pbctClsDtm}, cltrMnmtNo=${cltrMnmtNo})}">
                ë‹¤ìŒ í˜ì´ì§€ â†’
            </a>
        </div>
    </div>
</body>
</html>